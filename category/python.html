<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>Keep Learning - Python</title>
        <link rel="stylesheet" href="http://backnode.github.io/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

 	    <link rel="shortcut icon" href="http://backnode.github.io/theme/img/favicon.ico">

</head>

<body id="index" class="home">
<a href="https://github.com/BackNode/BackNode.github.io">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://backnode.github.io/">Keep Learning </a></h1>
                <nav><ul>
                    <li><a href="http://backnode.github.io/category/ml.html">ML</a></li>
                    <li><a href="http://backnode.github.io/category/opencv.html">opencv</a></li>
                    <li><a href="http://backnode.github.io/category/others.html">Others</a></li>
                    <li class="active"><a href="http://backnode.github.io/category/python.html">Python</a></li>
				<li><a href="http://backnode.github.io/archives.html">Archives</a></li>
                </ul>
<form id="search" action"#" onsubmit="javascript:window.open('http://google.com/?q='+document.getElementById('keywords').value+'+site:http://backnode.github.io');">
                        <input id="keywords" type="text" />
                    </form>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://backnode.github.io/pages/2015/08/01/funcProg-C2-Python.html">Function Programming in Python: 2. Callables</a></h1>
<footer class="post-info">
        <span>2015-08-01</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a><a href="http://backnode.github.io/tag/function-programming.html">function programming</a><a href="http://backnode.github.io/tag/han-shu-shi-bian-cheng.html">函数式编程</a></span>
</footer><!-- /.post-info --><h1>0. 前言</h1>
<hr />
<p><em>“Function Programming in Python”</em> Chapter 2：Callables</p>
<p>反复调用函数是函数式编程中的一个重点。在Python中有好多种不同的函数（或者说是可调用的something function-like）创建方式：</p>
<ol>
<li>
<p>用关键字<code>def</code>创建常规命名函数</p>
</li>
<li>
<p>用关键字<code>lambda</code>创建的匿名函数</p>
</li>
<li>
<p>定义了<code>__call__()</code>函数的类的实例</p>
</li>
<li>
<p>闭包（closures）</p>
</li>
<li>
<p>实例的静态函数</p>
</li>
<li>
<p>生成器函数</p>
</li>
</ol>
<p>纯函数（pure function）和无副作用代码（side-effect-free code）的好处是更容易调试和测试。很多时候在一个函数中side effects很难被完全消除，但是我们可以用函数式编程的思考方式在一定程度上削弱它。</p>
<h1>1. Named Functions and Lambdas</h1>
<hr />
<p>Named Functions和Lambdas的主要区别就在于是否有<code>__qualname__</code>属性。</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">hello1</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="o">.....</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="o">.....</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello1</span><span class="p">(</span><span class="s">&#39;David&#39;</span><span class="p">)</span>
<span class="n">Hello</span> <span class="n">David</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello2</span><span class="p">(</span><span class="s">&#39;David&#39;</span><span class="p">)</span>
<span class="n">Hello</span> <span class="n">David</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello1</span><span class="o">.</span><span class="n">__qualname__</span>
<span class="s">&#39;hello1&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello2</span><span class="o">.</span><span class="n">__qualname__</span>
<span class="s">&#39;&lt;lambda&gt;&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello3</span> <span class="o">=</span> <span class="n">hello2</span> <span class="c"># can bind func to other names</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello3</span><span class="o">.</span><span class="n">__qualname__</span>
<span class="s">&#39;&lt;lambda&gt;&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello3</span><span class="o">.</span><span class="n">__qualname__</span> <span class="o">=</span> <span class="s">&#39;hello3&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello3</span><span class="o">.</span><span class="n">__qualname__</span>
<span class="s">&#39;hello3&#39;</span>
</pre></div>


<h1>2. Closures and Callable Instances</h1>
<hr />
<p>有一种说法，类是“附带操作的数据(data with operations
attached)”，闭包（closure）是“附带数据的操作(operations with data attached)”。虽然两者都是把逻辑处理和数据放进一个对象，但是类强调的是可修改或可重绑定的状态，而闭包强调不可变性和纯函数。看一个简单的例子：</p>
<p>定义一个带有<code>__call()__</code>函数的类，这样这个类的实例就可被调用：</p>
<div class="highlight"><pre><span class="c"># A class that creates callable adder instances</span>
<span class="k">class</span> <span class="nc">Adder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span>
<span class="n">add5_i</span> <span class="o">=</span> <span class="n">Adder</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># &quot;instance&quot; or &quot;imperative&quot;</span>
</pre></div>


<p>一个闭包：</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">make_adder</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">adder</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">adder</span>
<span class="n">add5_f</span> <span class="o">=</span> <span class="n">make_adder</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># &quot;functional&quot;</span>
</pre></div>


<p>两种方式看起来完全一样，但是第一种方式中<code>add5_i</code>多了一个可修改的变量<code>self.n</code>。</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">add5_i</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add5_f</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># only argument affects result</span>
<span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add5_i</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># state is readily changeable</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add5_i</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># result is dependent on prior flow</span>
<span class="mi">20</span>
</pre></div>


<p>有一点需要<strong>注意</strong>，在Python中闭包的变量绑定是<strong>按变量名字传递，而不是变量值传递</strong>：</p>
<div class="highlight"><pre><span class="c"># almost surely not the behavior we intended!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">adders</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">adders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">adder</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">adder</span> <span class="ow">in</span> <span class="n">adders</span><span class="p">]</span>
<span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">adder</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">adder</span> <span class="ow">in</span> <span class="n">adders</span><span class="p">]</span>
<span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
</pre></div>


<p>显然上述结果不是我们想要的，但是做一点小改动就可以达到目的：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">adders</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="o">....</span>    <span class="n">adders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">:</span> <span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)</span>
<span class="o">....</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">adder</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">adder</span> <span class="ow">in</span> <span class="n">adders</span><span class="p">]</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">adder</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">adder</span> <span class="ow">in</span> <span class="n">adders</span><span class="p">]</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add4</span> <span class="o">=</span> <span class="n">adders</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c"># Can override the bound value</span>
<span class="mi">110</span>
</pre></div>


<h1>3. Methods of Classes</h1>
<hr />
<p>类中的所有<code>methods</code>都是可调用的。</p>
<h2>3.1 Accessors and Operators</h2>
<p>不管是否用<code>@property</code>修饰的accessors都是可调用的，但是accessors 作为getter不能传入参数，作为setter不能返回值：</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Speed is&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span>

    <span class="nd">@speed.setter</span>
    <span class="k">def</span> <span class="nf">speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Setting to&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span> <span class="o">=</span> <span class="n">value</span>

<span class="c"># &gt;&gt; car = Car()</span>
<span class="c"># &gt;&gt;&gt; car.speed = 80 # Odd syntax to pass one argument</span>
<span class="c"># Setting to 80</span>
<span class="c"># &gt;&gt;&gt; x = car.speed</span>
<span class="c"># Speed is 80</span>
</pre></div>


<p>python支持操作符重载，如下例重载操作符<code>&lt;&lt;</code>：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">TalkativeInt</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Shift&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<span class="o">....</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">TalkativeInt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>
<span class="n">Shift</span> <span class="mi">8</span> <span class="n">by</span> <span class="mi">3</span>
<span class="mi">64</span>
</pre></div>


<h2>3.2 Static Methods of Instances</h2>
<p>有时候我们需要把一些纯函数放在类中，避免它污染外部名字空间，但是我们希望这些纯函数通过类本身也可以调用，而不是只能通过类的一个实例调用，这时候我们需要<code>@staticmethod</code>：</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>
<span class="k">class</span> <span class="nc">RightTriangle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">&quot;Class used solely as namespace for related functions&quot;</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">hypotenuse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">RightTriangle</span><span class="o">.</span><span class="n">hypotenuse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">/</span> <span class="n">RightTriangle</span><span class="o">.</span><span class="n">hypotenuse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">RightTriangle</span><span class="o">.</span><span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="mf">5.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">RightTriangle</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="mf">0.6</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rt</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="mf">0.8</span>
</pre></div>


<p>如果你的名字空间中全部都是纯函数，那你应该通过类（class）访问它们，而不是类的实例（instance）。但是如果你要将一些纯函数和一些依赖实例变量的函数混合进类中，那你应该用<code>@staticmethod</code>修饰纯函数。</p>
<h2>3.3 Generator Functions</h2>
<p>生成器函数返回的不是一个常规的值，而是一个可迭代的生成器。</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_primes</span><span class="p">():</span>
    <span class="s">&quot;Simple lazy Sieve of Eratosthenes&quot;</span>
    <span class="n">candidate</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">candidate</span> <span class="o">%</span> <span class="n">prime</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">prime</span> <span class="ow">in</span> <span class="n">found</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">candidate</span>
            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="n">candidate</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">primes</span> <span class="o">=</span> <span class="n">get_primes</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">primes</span><span class="p">),</span> <span class="nb">next</span><span class="p">(</span><span class="n">primes</span><span class="p">),</span> <span class="nb">next</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">prime</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">primes</span><span class="p">):</span>
<span class="o">...</span> <span class="k">print</span><span class="p">(</span><span class="n">prime</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="o">....</span>
<span class="mi">7</span> <span class="mi">11</span> <span class="mi">13</span> <span class="mi">17</span> <span class="mi">19</span> <span class="mi">23</span> <span class="mi">29</span> <span class="mi">31</span> <span class="mi">37</span> <span class="mi">41</span>
</pre></div>


<p>你或许注意到了，上例中返回的<code>generator</code>里面是一个无限大的序列，这个无限长的序列并非在<code>get_primes()</code>返回时就已经生成并存储在内存中，而是在真正使用<code>generator</code>时，才一个一个生成出来。实际上这个黑魔法关键在<code>yield</code>上，在程序执行到<code>yield</code>这行时，它会在<code>return</code>一个值之后把这个函数<strong>“冻”</strong>住，保存好其中的所有变量，等到下次这个<code>generator</code>被调用（<code>next()</code>）的时候<strong>“解冻”</strong>。需要注意的是，生成器推导式虽然也可以返回一个生成器，但是经过实验证明，它并不具备<code>yield</code>那种魔法，也就是说生成器推导式并不似定义生成器函数那样节省内存。<strong>当需要获取非常大的序列时，应当定义一个生成器函数（使用<code>yield</code>关键字）。</strong></p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">gt</span><span class="p">():</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000000</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">yield</span> <span class="n">i</span>
   <span class="o">...</span><span class="p">:</span>         

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gt</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">generator</span>   <span class="c"># 此时ipython仅占用内存47508K</span>
</pre></div>


<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span> <span class="p">)</span>    
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">generator</span>     <span class="c">#内存占用3G多</span>
</pre></div>


<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">g</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000000</span><span class="p">)</span> <span class="p">]</span>   <span class="c"># 内存同样占用3G多</span>
</pre></div>


<p>另外，生成器函数作为函数自然可以接收参数：</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">gt</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="mi">100000000</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">yield</span> <span class="n">i</span>
   <span class="o">...</span><span class="p">:</span>         

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">g</span> <span class="o">=</span> <span class="n">gt</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">g</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">20</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> 
</pre></div>


<ol>
<li>
<p><code>generator</code>用于生成一串值</p>
</li>
<li>
<p><code>yield</code>关键字和<code>return</code>很像，但是<code>yield</code>多干一件事：保存生成器函数的“状态”</p>
</li>
<li>
<p>生成器只是一种特殊的迭代器</p>
</li>
<li>
<p>我们可以使用<code>next()</code>获取生成器的下一个值（for循环获取值实际上是隐式调用<code>next()</code>）</p>
</li>
</ol>
<p>更多关于<code>generator</code>和<code>yield</code>的讨论可以戳<a href="http://www.jeffknupp.com/blog/2013/04/07/improve-your-python-yield-and-generators-explained/">这里</a>。</p>
<h1>4. Multiple Dispatch</h1>
<hr />
<p>在程序设计语言中，许多时候同一个概念的操作或运算可能需要针对不同数量、不同类型的数据而做不同的处理。既然是“同一概念”，如果能用同样的名字来命名这个操作或运算的函数，会有助于程序代码清晰的表达出语义。但是函数的名字一样了，程序该如何判断应该选用同名函数的哪个版本就成了个问题，这里就需要在编译时由编译器来选择，或在运行时进行方法分派。</p>
<p>参数的数量、类型等信息组成了函数的signature。在不同语言中，函数的signature不仅可以包含参数的数量、类型，也可能包含参数的结构/模式，甚至可能包括返回类型的数量和类型。在C++中，使用同一个名字来命名signature不同的函数，叫做函数重载。然后Python中并没有函数重载，但是我们依然需要多分派技术。</p>
<p>剪刀石头布的例子：</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Rock</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Paper</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Scissors</span><span class="p">(</span><span class="n">Thing</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>


<h2>4.1 Many Branches</h2>
<p>一个纯粹imperative的版本，有很多重复、条件判断、嵌套等：</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">beats</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">y</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown first thing&quot;</span><span class="p">)</span>
<span class="n">rock</span><span class="p">,</span> <span class="n">paper</span><span class="p">,</span> <span class="n">scissors</span> <span class="o">=</span> <span class="n">Rock</span><span class="p">(),</span> <span class="n">Paper</span><span class="p">(),</span> <span class="n">Scissors</span><span class="p">()</span>
<span class="c"># &gt;&gt;&gt; beats(paper, rock)</span>
<span class="c"># &lt;__main__.Paper at 0x103b96b00&gt;</span>
<span class="c"># &gt;&gt;&gt; beats(paper, 3)</span>
<span class="c"># TypeError: Unknown second thing</span>
</pre></div>


<h2>4.2 Delegating to the Object</h2>
<p>要改进上例，我们可以先考虑分离出三个类，将<code>beats</code>分别委派给各个类：</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">DuckRock</span><span class="p">(</span><span class="n">Rock</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">beats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DuckPaper</span><span class="p">(</span><span class="n">Paper</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">beats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span> 

<span class="k">class</span> <span class="nc">DuckScissors</span><span class="p">(</span><span class="n">Scissors</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">beats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Rock</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Paper</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c"># No winner</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">beats2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;beats&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">beats</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown first thing&quot;</span><span class="p">)</span>

<span class="n">rock</span><span class="p">,</span> <span class="n">paper</span><span class="p">,</span> <span class="n">scissors</span> <span class="o">=</span> <span class="n">DuckRock</span><span class="p">(),</span> <span class="n">DuckPaper</span><span class="p">(),</span> <span class="n">DuckScissors</span><span class="p">()</span>
<span class="c"># &gt;&gt;&gt; beats2(rock, paper)</span>
<span class="c"># &lt;__main__.DuckPaper at 0x103b894a8&gt;</span>
<span class="c"># &gt;&gt;&gt; beats2(3, rock)</span>
<span class="c"># TypeError: Unknown first thing</span>
</pre></div>


<h2>4.3 Pattern Matching</h2>
<p>最后，我们可以更直接地使用多分派技术表达所有的逻辑，虽然函数数目有点多，但是逻辑更清晰，不易出错：</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">multipledispatch</span> <span class="kn">import</span> <span class="n">dispatch</span>
<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Rock</span><span class="p">,</span> <span class="n">Rock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Rock</span><span class="p">,</span> <span class="n">Paper</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">y</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Rock</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Paper</span><span class="p">,</span> <span class="n">Rock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Paper</span><span class="p">,</span> <span class="n">Paper</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Paper</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Scissors</span><span class="p">,</span> <span class="n">Rock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">y</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Scissors</span><span class="p">,</span> <span class="n">Paper</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="n">Scissors</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>

<span class="nd">@dispatch</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">beats3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">Rock</span><span class="p">,</span> <span class="n">Paper</span><span class="p">,</span> <span class="n">Scissors</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown first thing&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Unknown second thing&quot;</span><span class="p">)</span>

<span class="c"># &gt;&gt;&gt; beats3(rock, paper)</span>
<span class="c"># &lt;__main__.DuckPaper at 0x103b894a8&gt;</span>
<span class="c"># &gt;&gt;&gt; beats3(rock, 3)</span>
<span class="c"># TypeError: Unknown second thing</span>
</pre></div>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2015/07/29/funcProg-Python.html" rel="bookmark"
                           title="Permalink to Function Programming in Python: 1. (Avoiding) Flow Control">Function Programming in Python: 1. (Avoiding) Flow Control</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2015-07-29</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a><a href="http://backnode.github.io/tag/function-programming.html">function programming</a><a href="http://backnode.github.io/tag/han-shu-shi-bian-cheng.html">函数式编程</a></span>
</footer><!-- /.post-info -->                <h1>0. whatever</h1>
<hr />
<p><em>“Function Programming in Python”</em> Chapter 1：避免流控制</p>
<p>在传统的imperative式编程中，一段代码通常包括一些循环（<code>while</code>或<code>for</code>）、变量的声明和数据的修改（dict，list，set等）、分支语句（<code>if/elif/else/</code>, <code>try/except/finally</code>）。所有这些看起来都很自然，很好理解。这些状态变量和可修改的数据结构通常从现实世界中抽象而来，但是它们会带来一些副作用，<strong>随意给定程序的一个断点，我们很难靠人脑快速精确地推断出这些数据里面的值</strong>，所以我们经常需要依靠编译器的帮助来查看这些数据里面的值是不是我们想要的那样。</p>
<p>一个解决方案是使我们的代码专注于描述数据是什么（<strong>what</strong>），而不是如何构建数据（<strong>how</strong>）.</p>
<h1>1. Encapsulation （封装）</h1>
<hr />
<p>最先想到的专注于“what”而不是“how”的方法就是：重构代码，把数据构建的操作放在一个独立的地方。考虑改写如下代码：</p>
<div class="highlight"><pre><span class="c"># configure the data ...</span></pre></div>
                <a class="readmore" href="http://backnode.github.io/pages/2015/07/29/funcProg-Python.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2015/04/16/knapsack-bnb.html" rel="bookmark"
                           title="Permalink to 离散优化之Knapsack问题（二）：relaxation, branch and bound">离散优化之Knapsack问题（二）：relaxation, branch and bound</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2015-04-16</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a><a href="http://backnode.github.io/tag/bnb.html">bnb</a></span>
</footer><!-- /.post-info -->                <h1>knapsack问题之relaxation, branch and bound</h1>
<p>转载请注明出处：<a href="http://backnode.github.io/pages/2015/04/16/knapsack-bnb.html">BackNode</a>
我们接着上回（<a href="http://backnode.github.io/pages/2015/04/14/knapsack-dp.html">传送门：动态规划</a>）继续分析knapsack问题。</p>
<h2>问题描述</h2>
<p>你有一个负重量为<code>capacity</code>的背包，摆在你面前的是一堆宝物，宝物有重量<code>weight</code>和价值<code>value</code>，你要在你的背包中装下宝物将它们占为己有，因此你希望背包中的宝物负重量不超过<code>capacity</code>，同时背包中的宝物的价值<code>value</code>尽可能的大。
输入：</p>
<div class="highlight"><pre><span class="mi">4</span> <span class="mi">11</span> 
<span class="mi">8</span> <span class="mi">4</span>
<span class="mi">10</span> <span class="mi">5</span>
<span class="mi">15</span> <span class="mi">8</span>
<span class="mi">4</span> <span class="mi">3</span>
</pre></div>


<p>第一行<code>4 11</code>表示宝物数量<code>item_count</code>为4，背包负重量<code>capacity</code>为11
接下来为<code>item_count</code>行，每行第一个元素是该宝物的价值<code>value ...</code></p>
                <a class="readmore" href="http://backnode.github.io/pages/2015/04/16/knapsack-bnb.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2015/04/14/knapsack-dp.html" rel="bookmark"
                           title="Permalink to 离散优化之Knapsack问题（一）：动态规划">离散优化之Knapsack问题（一）：动态规划</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2015-04-14</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a><a href="http://backnode.github.io/tag/dp.html">dp</a></span>
</footer><!-- /.post-info -->                <h1>knapsack问题之动态规划</h1>
<h2>问题描述</h2>
<p>你有一个负重量为<code>capacity</code>的背包，摆在你面前的是一堆宝物，宝物有重量<code>weight</code>和价值<code>value</code>，你要在你的背包中装下宝物将它们占为己有，因此你希望背包中的宝物负重量不超过<code>capacity</code>，同时背包中的宝物的价值<code>value</code>尽可能的大。
输入：</p>
<div class="highlight"><pre><span class="mi">4</span> <span class="mi">11</span> 
<span class="mi">8</span> <span class="mi">4</span>
<span class="mi">10</span> <span class="mi">5</span>
<span class="mi">15</span> <span class="mi">8</span>
<span class="mi">4</span> <span class="mi">3</span>
</pre></div>


<p>第一行<code>4 11</code>表示宝物数量<code>item_count</code>为4，背包负重量<code>capacity</code>为11
接下来为<code>item_count</code>行，每行第一个元素是该宝物的价值<code>value</code>，第二个元素是该宝物的重量<code>weight</code>。</p>
<h2>问题建模</h2>
<p><img alt="数学模型" src="http://keepcodingblog.qiniudn.com/knapsack-modeling.jpg" /></p>
<p><code>x[i]=1</code>表示选中宝物<code>i</code>,<code>x ...</code></p>
                <a class="readmore" href="http://backnode.github.io/pages/2015/04/14/knapsack-dp.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2015/03/30/python-local-global.html" rel="bookmark"
                           title="Permalink to python学习--locals globals">python学习--locals globals</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2015-03-30</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a></span>
</footer><!-- /.post-info -->                <h1>python学习--locals globals</h1>
<h2>locals() and globals()</h2>
<p><code>locals()</code>和<code>globals()</code>是python的两个内置函数，它们提供了基于dictionary的访问局部和全局变量的方式。
<code>locals()</code>返回一个名字/值对的dictionary。这个dictionary的键字是字符串形式的变量名字，diction的值是变量的实际值。</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">num</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span> <span class="nb">locals</span><span class="p">()[</span><span class="s">&#39;arg&#39;</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span>     

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">func</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="s">&#39;num&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s">&#39;arg&#39;</span><span class="p">:</span> <span class="s">&#39;hello&#39;</span><span class="p">}</span>
<span class="n">hello</span>
</pre></div>


<p><code>globals()</code>函数则返回包含全局变量的dictionary，在下例中，<code>operation()</code>函数根据<code>oper</code>变量的值自动调用相应的全局函数：</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return ...</span></pre></div>
                <a class="readmore" href="http://backnode.github.io/pages/2015/03/30/python-local-global.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2015/03/29/python-itertools.html" rel="bookmark"
                           title="Permalink to python学习--itertools模块">python学习--itertools模块</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2015-03-29</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a></span>
</footer><!-- /.post-info -->                <h1>python学习：itertools</h1>
<p>itertools模块包含一系列迭代数据集的函数，如下三个表格：</p>
<p><img alt="iterators" src="http://keepcodingblog.qiniudn.com/iterators.jpg" /></p>
<p>下面挑常用的举例学习一下：</p>
<h2>itertools.count(start=0,step=1)和itertools.izip(*iterables)</h2>
<p>count()函数生成从start(default=0)开始的以step(default=1)为步长的连续整数，
izip()函数将多个迭代器中的元素合并为一个元组并作为一个迭代器返回，类似于zip()函数
使用：</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">]):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">print</span> <span class="n">i</span> 
   <span class="o">...</span><span class="p">:</span>     
<span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s">&#39;b ...</span></pre></div>
                <a class="readmore" href="http://backnode.github.io/pages/2015/03/29/python-itertools.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2014/11/29/python-spider-first.html" rel="bookmark"
                           title="Permalink to 初学Python----urllib2模块与正则表达式组合而成的小爬虫">初学Python----urllib2模块与正则表达式组合而成的小爬虫</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2014-11-29</span>
<span>| tags: <a href="http://backnode.github.io/tag/python.html">python</a><a href="http://backnode.github.io/tag/spider.html">spider</a></span>
</footer><!-- /.post-info -->                <p>最近开始学Python，在http://www.the5fire.com/python-sohuspider-software-people.html这个博客上看到作者写的简单的从搜狐上爬小说的爬虫，正好学习学习练练手，发现代码是几年前的，而搜狐网早已经更新了网页，原代码已经不能用了，正好我来改改。下面是改过之后的代码，亲测有效：</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">getPage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">offset</span> <span class="o">=</span> <span class="s">&#39;3399&#39;</span><span class="p">):</span>
    <span class="n">realurl</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">offset</span><span class="p">,</span><span class="s">&quot;.html&quot;</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">realurl</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">realurl</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">content_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;div class=&quot;chapter&quot;&gt;&lt;/div ...</span></pre></div>
                <a class="readmore" href="http://backnode.github.io/pages/2014/11/29/python-spider-first.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://backnode.github.io/pages/2014/11/29/python_challenge.html" rel="bookmark"
                           title="Permalink to pythonChallenge攻略">pythonChallenge攻略</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>2014-11-29</span>
<span>| tags: <a href="http://backnode.github.io/tag/pythonchallenge.html">pythonChallenge</a></span>
</footer><!-- /.post-info -->                <p>http://www.pythonchallenge.com/是一个非常棒的练习python的网站，以过关解密的形式来帮助你学习python，现将我的解密过程记录如下。</p>
<h1>第0关：warming up</h1>
<p>这关就一张图片，显示2的38次方，下方提示：try to change the URL address
OK，那我们就计算一下2的38次方，在python中输入：</p>
<div class="highlight"><pre>2**38
</pre></div>


<p>在python中两个*号表示次方运算，得出答案：</p>
<div class="highlight"><pre>&gt;&gt;&gt; 2**38
274877906944L
</pre></div>


<p>根据提示修改url，将0替换成上面这串数字，然后网页提示L不需要，我们去掉L再替换，
过关！</p>
<h1>第1关：what about making trans</h1>
<p>图中显示将字母k换成m，o换成q，e换成g，即每个字母往后推移两位，看来得将下面那一
大段字符转换一下，这里使用两个函数chr(),和ord().</p>
<div class="highlight"><pre><span class="n">string</span> <span class="o">=</span> <span class="s">&quot;g ...</span></pre></div>
                <a class="readmore" href="http://backnode.github.io/pages/2014/11/29/python_challenge.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="https://wen.lu/">Google</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/BackNode">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://docs.getpelican.com/en/3.6.3/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61296690-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fc1e5277b46b034d174091d85f9f8a565' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>